@model DashboardViewModel
@{
    ViewData["Title"] = "Dashboard";
}

<h4 class="text-white mb-4"><i class="bi bi-speedometer2"></i> Dashboard</h4>

<div class="row mb-4">
    <div class="col-md-3">
        @await Component.InvokeAsync("CartaoResumo", new {
            titulo = "Total Recebido (Mês)",
            valor = Model.TotalRecebido.ToString("C", new System.Globalization.CultureInfo("pt-BR")),
            icone = "cash-stack",
            classCor = "success"
        })
    </div>
    <div class="col-md-3">
        @await Component.InvokeAsync("CartaoResumo", new {
            titulo = "Total Pendente",
            valor = Model.TotalPendente.ToString("C", new System.Globalization.CultureInfo("pt-BR")),
            icone = "hourglass-split",
            classCor = "warning"
        })
    </div>
    <div class="col-md-3">
        @await Component.InvokeAsync("CartaoResumo", new {
            titulo = "Total em Atraso",
            valor = Model.TotalAtrasado.ToString("C", new System.Globalization.CultureInfo("pt-BR")),
            icone = "exclamation-triangle",
            classCor = "danger"
        })
    </div>
    <div class="col-md-3">
        @await Component.InvokeAsync("CartaoResumo", new {
            titulo = "Caixas Ativas",
            valor = Model.QuantidadeCaixasAtivas.ToString(),
            icone = "mailbox",
            classCor = "info"
        })
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-6">
        <div class="card bg-dark border-secondary">
            <div class="card-header text-white">
                <i class="bi bi-pie-chart"></i> Status das Cobranças
            </div>
            <div class="card-body">
                <canvas id="graficoRosca" height="250"></canvas>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card bg-dark border-secondary">
            <div class="card-header text-white">
                <i class="bi bi-graph-up"></i> Pagamentos - Últimos 6 Meses
            </div>
            <div class="card-body">
                <canvas id="graficoLinha" height="250"></canvas>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-6">
        <div class="card bg-dark border-secondary">
            <div class="card-header text-white">
                <i class="bi bi-calendar-event"></i> Próximos Vencimentos (7 dias)
            </div>
            <div class="card-body p-0">
                <table class="table table-dark table-hover mb-0">
                    <thead>
                        <tr>
                            <th>Caixa</th>
                            <th>Cliente</th>
                            <th>Vencimento</th>
                            <th>Valor</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model.ProximosVencimentos.Count == 0)
                        {
                            <tr><td colspan="4" class="text-center text-muted">Nenhum vencimento próximo</td></tr>
                        }
                        @foreach (var alerta in Model.ProximosVencimentos)
                        {
                            <tr>
                                <td>@alerta.CodigoCaixa</td>
                                <td>@alerta.NomeCliente</td>
                                <td>@alerta.DataVencimento.ToString("dd/MM/yyyy")</td>
                                <td>@alerta.Valor.ToString("C", new System.Globalization.CultureInfo("pt-BR"))</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card bg-dark border-danger">
            <div class="card-header text-white">
                <i class="bi bi-exclamation-circle"></i> Cobranças em Atraso
            </div>
            <div class="card-body p-0">
                <table class="table table-dark table-hover mb-0">
                    <thead>
                        <tr>
                            <th>Caixa</th>
                            <th>Cliente</th>
                            <th>Vencimento</th>
                            <th>Valor</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model.CobrancasEmAtraso.Count == 0)
                        {
                            <tr><td colspan="4" class="text-center text-muted">Nenhuma cobrança em atraso</td></tr>
                        }
                        @foreach (var alerta in Model.CobrancasEmAtraso)
                        {
                            <tr class="table-danger">
                                <td>@alerta.CodigoCaixa</td>
                                <td>@alerta.NomeCliente</td>
                                <td>@alerta.DataVencimento.ToString("dd/MM/yyyy")</td>
                                <td>@alerta.Valor.ToString("C", new System.Globalization.CultureInfo("pt-BR"))</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/dashboard.js"></script>
    <script>
        inicializarGraficoRosca(@Model.CobrancasPendentes, @Model.CobrancasPagas, @Model.CobrancasAtrasadas);
        inicializarGraficoLinha(@Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.RotulosMeses)), @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.ValoresPorMes)));
    </script>
}
